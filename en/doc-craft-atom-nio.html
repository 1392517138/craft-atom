<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
	  	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	  	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	  	<link rel="icon" href="../favicon.ico" type="image/x-icon">
	  	<link rel="stylesheet" href="../css/craft.css">
	  	<link rel="stylesheet" href="../css/code.css">
		<script type="text/javascript" src="../js/jquery.js"></script>
		<script type="text/javascript" src="../js/craft.js"></script>
		<script type="text/javascript" src="../js/rainbow.js"></script>
		<script type="text/javascript" src="../js/rainbow.generic.js"></script>
		<script type="text/javascript" src="../js/rainbow.java.js"></script>
		<title>Documentation: craft-atom-nio</title>
	</head>

	<body>
		<div id="header" class="header"></div>
		
		<div id="center" class="center">
			<div id="content" class="content">
<h1>craft-atom-nio</h1>
<div class="date">Mar 15, 2014 by mindwind</div>

<h3>Introduction</h3>
<p>
An asynchronous event-driven net io component base on java NIO, it implements <a href="doc-craft-atom-io.html" target="_blank">craft-atom-io</a> api model definition.
</p>

<h3>Getting Started</h3>
<p>
Before getting started, you should understand the reactor io model, defined in the <a href="doc-craft-atom-io.html" target="_blank">craft-atom-io</a>.
Then we get started with a simple example, and you will learn how to write a client and server on top of <a href="#">craft-atom-nio</a>.
</p>

<p>
<b>Writing an Echo Server</b><br>
In order to use <a href="#">craft-atom-nio</a> the only thing to do is implements <code>IoHandler</code> which handles I/O events.
An example as follows:
</p>
<pre><code data-language="java">
public class NioEchoServerHandler extends AbstractIoHandler {
	
    @Override
    public void channelRead(Channel&lt;byte[]&gt; channel, byte[] bytes) {
        channel.write(bytes);
    }
}
</code></pre>
<p>
So far so good. We have implemented the first part of the Echo Server. 
What's left now is to write the main() method which starts the server with the <code>NioEchoServerHandler</code>.
</p>
<pre><code data-language="java">
public class NioEchoServer {

    private int port;
	
    public NioEchoServer(int port) {
        this.port = port;
    }
    
    public void start() throws IOException {
        IoAcceptor acceptor = NioFactory.newTcpAcceptorBuilder(new NioEchoServerHandler()).build();
        acceptor.bind(port);
    }
    
    public static void main(String[] args) throws IOException {
        new NioEchoServer(1314).start();
    }
}
</code></pre>
<p>
Congratulations! Our Echo Server done.
</p>

<p>
<b>Writing an Echo Client</b><br>
It is similar to Echo Server, first we need implement a client handler, as follows:
</p>
<pre><code data-language="java">
public class NioEchoClientHandler extends AbstractIoHandler {
	
    private AtomicInteger counter = new AtomicInteger();
	
    @Override
    public void channelOpened(Channel&lt;byte[]&gt; channel) {
        send(channel);
    }
	
    @Override
    public void channelRead(Channel&lt;byte[]&gt; channel, byte[] bytes) {
        System.out.println("ECHO-RECV: " + new String(bytes));
        try { Thread.sleep(1000); } catch (InterruptedException e) {}
        send(channel);
    }
    
    private void send(Channel&lt;byte[]&gt; channel) {
        String toSend = Integer.toString(counter.incrementAndGet());
        channel.write(toSend.getBytes());
        System.out.println("ECHO-SENT: " + toSend);
    }
}
</code></pre>

<p>
An client with main() method as follows:
</p>
<pre><code data-language="java">
public class NioEchoClient {

    private String ip;
    private int port;	
    
    public NioEchoClient(String ip, int port) {
        this.ip = ip;
        this.port = port;
    }
    
    public void start() throws IOException {
        IoConnector connector = NioFactory.newTcpConnectorBuilder(new NioEchoClientHandler())
                                             .connectTimeoutInMillis(3000).build();
        connector.connect(ip, port);
    }
    
    public static void main(String[] args) throws IOException {
        new NioEchoClient("127.0.0.1", 1314).start();
    }
}
</code></pre>

<h3>Advanced</h3>
<p>
Actually above Echo Server and Client example lack a important part in network programming. The missing part is protocol
codec, because they don't need it, but a complete client and server must handle protocol codec.<br>
</p>

<p>
<b>Protocol Codec</b><br>
For simplicity and atomicity <a href="#">craft-atom-nio</a> is not responsible for protocol codec. 
The responsibility of protocol codec belong to <a href="doc-craft-atom-protocol" target="_blank">craft-atom-protocol</a> series components.
</p>

<p>
<b>Thread Model</b><br>
<a>Thread Model Illustration</a>: I/O thread, executor and dispatcher.
</p>

<p>
<b>Event Model</b><br>
<a>Event Model Illustration</a>: Event definition and handle.
</p>

<p>
<b>Performance</b><br>
<a>Benchmark and Comparison with mina and netty</a>: Fast enough?
</p>
			</div>
		</div>
		
		<div id="footer" class="footer"></div>
	</body>
</html>